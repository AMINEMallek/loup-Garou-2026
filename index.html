<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loup-Garou - Jeu Multijoueur</title>
    <meta name="theme-color" content="#7c3aed">
    <meta name="description" content="Jeu du Loup-Garou multijoueur en temps r√©el">
    <link rel="manifest" href="./manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Loup-Garou">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .cinzel {
            font-family: 'Cinzel', serif;
        }

        @keyframes fade-in {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fade-in 0.6s ease-out;
        }

        @keyframes pulse-glow {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .bg-pattern {
            background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiNmZmZmZmYiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PHBhdGggZD0iTTM2IDE2YzAtMy4zMTQgMi42ODYtNiA2LTZzNi0yLjY4NiA2LTYtMi42ODYtNi02LTYtNiAyLjY4Ni02IDYgMi42ODYgNiA2IDZ6Ii8+PC9nPjwvZz48L3N2Zz4=');
        }

        .night-bg {
            background: linear-gradient(to bottom right, #0f172a, #1e1b4b, #0f172a);
        }

        .day-bg {
            background: linear-gradient(to bottom right, #fef3c7, #fde68a, #fbbf24);
        }
    </style>
</head>

<body class="min-h-screen">
    <div class="absolute inset-0 bg-pattern opacity-30"></div>
    <div id="app"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyDNRsFPDUDg5NzArWXxc6MQGYNTTAQdOxI",
            authDomain: "loupgarou2016.firebaseapp.com",
            databaseURL: "https://loupgarou2016-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "loupgarou2016",
            storageBucket: "loupgarou2016.firebasestorage.app",
            messagingSenderId: "124320980678",
            appId: "1:124320980678:web:5c27d4568027efbf4841c7"
        };

        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            console.log('‚úÖ Firebase connect√©');
        } catch (error) {
            console.error('‚ùå Erreur Firebase:', error);
        }

        const Moon = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>;
        const Sun = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>;
        const Users = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>;
        const Crown = (props) => <svg className={props.className} fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M5 2a1 1 0 011 1v1h1a1 1 0 010 2H6v1a1 1 0 01-2 0V6H3a1 1 0 010-2h1V3a1 1 0 011-1zm0 10a1 1 0 011 1v1h1a1 1 0 110 2H6v1a1 1 0 11-2 0v-1H3a1 1 0 110-2h1v-1a1 1 0 011-1zM12 2a1 1 0 01.967.744L14.146 7.2 17.5 9.134a1 1 0 010 1.732l-3.354 1.935-1.18 4.455a1 1 0 01-1.933 0L9.854 12.8 6.5 10.866a1 1 0 010-1.732l3.354-1.935 1.18-4.455A1 1 0 0112 2z" clipRule="evenodd" /></svg>;
        const Eye = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>;
        const Droplet = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>;
        const Target = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
        const Cross = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
        const Skull = (props) => <svg className={props.className} fill="currentColor" viewBox="0 0 20 20"><path fillRule="evenodd" d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 16a1 1 0 01-1-1v-1h2v1a1 1 0 01-1 1z" clipRule="evenodd" /></svg>;
        const AlertCircle = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>;
        const Copy = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>;
        const Check = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>;
        const LogOut = (props) => <svg className={props.className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>;

        const roles = [
            { id: 'loupGarou', name: 'Loup-Garou', icon: Moon, color: '#dc2626', description: 'Tue un villageois chaque nuit' },
            { id: 'villageois', name: 'Villageois', icon: Users, color: '#10b981', description: 'Vote pendant la journ√©e' },
            { id: 'voyante', name: 'Voyante', icon: Eye, color: '#8b5cf6', description: 'Voit UNE carte par nuit' },
            { id: 'sorciere', name: 'Sorci√®re', icon: Droplet, color: '#ec4899', description: 'Peut sauver OU tuer (1 fois chacun)' },
            { id: 'chasseur', name: 'Chasseur', icon: Target, color: '#f59e0b', description: 'Tire sur quelqu\'un en mourant' },
            { id: 'pretre', name: 'Pr√™tre', icon: Cross, color: '#06b6d4', description: 'B√©nit une personne chaque nuit' }
        ];

        const LoupGarou = () => {
            const [screen, setScreen] = useState('home');
            const [playerName, setPlayerName] = useState('');
            const [roomCode, setRoomCode] = useState('');
            const [currentRoom, setCurrentRoom] = useState(null);
            const [players, setPlayers] = useState([]);
            const [isHost, setIsHost] = useState(false);
            const [gameState, setGameState] = useState(null);
            const [copied, setCopied] = useState(false);
            const [error, setError] = useState('');
            const [nightTimer, setNightTimer] = useState(120);
            const [voteTimer, setVoteTimer] = useState(30);
            const roomRef = useRef(null);

            const [roleConfig, setRoleConfig] = useState({
                loupGarou: 2, villageois: 2, voyante: 1, sorciere: 1, chasseur: 1, pretre: 0
            });

            useEffect(() => {
                if (!roomCode || !db) return;
                roomRef.current = db.ref(`rooms/${roomCode}`);
                const listener = roomRef.current.on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        setCurrentRoom(data);
                        setPlayers(data.players || []);
                        if (data.gameState) {
                            setGameState(data.gameState);
                            if (data.status === 'playing' && screen !== 'game') setScreen('game');
                        }
                    }
                });
                return () => { if (roomRef.current) roomRef.current.off('value', listener); };
            }, [roomCode]);

            useEffect(() => {
                if (gameState?.phase === 'night' && nightTimer > 0) {
                    const timer = setTimeout(() => setNightTimer(nightTimer - 1), 1000);
                    return () => clearTimeout(timer);
                } else if (gameState?.phase === 'night' && nightTimer === 0 && isHost) {
                    endNight();
                }
            }, [gameState?.phase, nightTimer]);

            useEffect(() => {
                if (gameState?.phase === 'vote' && voteTimer > 0) {
                    const timer = setTimeout(() => setVoteTimer(voteTimer - 1), 1000);
                    return () => clearTimeout(timer);
                } else if (gameState?.phase === 'vote' && voteTimer === 0 && isHost) {
                    endVoting();
                }
            }, [gameState?.phase, voteTimer]);

            const generateRoomCode = () => Math.floor(100000 + Math.random() * 900000).toString();

            const createRoom = async () => {
                if (!playerName.trim()) { setError('Entrez votre nom'); return; }
                if (!db) { setError('Firebase non configur√©'); return; }
                const code = generateRoomCode();
                const room = { code, host: playerName, players: [{ name: playerName, id: Date.now().toString(), isAlive: true }], status: 'lobby', createdAt: Date.now() };
                try {
                    await db.ref(`rooms/${code}`).set(room);
                    setRoomCode(code); setCurrentRoom(room); setIsHost(true); setPlayers(room.players); setScreen('lobby'); setError('');
                } catch (err) { setError('Erreur: ' + err.message); }
            };

            const joinRoom = async () => {
                if (!playerName.trim() || !roomCode.trim()) { setError('Entrez votre nom et le code'); return; }
                if (!db) { setError('Firebase non configur√©'); return; }
                try {
                    const snapshot = await db.ref(`rooms/${roomCode}`).once('value');
                    const room = snapshot.val();
                    if (!room) { setError('Salon introuvable'); return; }
                    if (room.status !== 'lobby') { setError('‚ùå La partie a d√©j√† commenc√© !'); return; }
                    room.players.push({ name: playerName, id: Date.now().toString(), isAlive: true });
                    await db.ref(`rooms/${roomCode}`).set(room);
                    setCurrentRoom(room); setPlayers(room.players); setIsHost(false); setScreen('lobby'); setError('');
                } catch (err) { setError('Erreur: ' + err.message); }
            };

            const leaveRoom = async () => {
                if (isHost && db) {
                    try { await db.ref(`rooms/${roomCode}`).remove(); } catch (err) { }
                } else if (db && currentRoom) {
                    try {
                        const newPlayers = currentRoom.players.filter(p => p.name !== playerName);
                        await db.ref(`rooms/${roomCode}/players`).set(newPlayers);
                    } catch (err) { }
                }
                setScreen('home'); setCurrentRoom(null); setRoomCode(''); setPlayers([]); setGameState(null);
            };

            const copyRoomCode = () => {
                navigator.clipboard.writeText(roomCode);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const startGame = async () => {
                if (!db) return;
                const totalRoles = Object.values(roleConfig).reduce((a, b) => a + b, 0);
                if (totalRoles !== players.length) { setError(`Configurez ${players.length} r√¥les`); return; }
                const deck = [];
                Object.entries(roleConfig).forEach(([role, count]) => {
                    for (let i = 0; i < count; i++) deck.push(role);
                });
                const shuffled = deck.sort(() => Math.random() - 0.5);
                const playersWithRoles = players.map((player, index) => ({
                    ...player,
                    role: shuffled[index],
                    isAlive: true,
                    hasVoted: false,
                    hasActed: false,
                    sorciereKillUsed: false,
                    sorciereHealUsed: false,
                    voyanteSeen: false,
                    lastBlessedId: null
                }));
                const newGameState = { players: playersWithRoles, phase: 'sleep', round: 1, nightActions: {}, dayMessage: 'Le village s\'endort...' };
                try {
                    await db.ref(`rooms/${roomCode}`).update({ status: 'playing', gameState: newGameState });
                    setGameState(newGameState); setScreen('game'); setError('');
                    setTimeout(() => startNight(), 3000);
                } catch (err) { setError('Erreur: ' + err.message); }
            };

            const startNight = async () => {
                if (!db || !isHost) return;
                const newGameState = { ...gameState };
                newGameState.phase = 'night';
                newGameState.nightActions = {};
                newGameState.dayMessage = 'La nuit tombe...';
                newGameState.players.forEach(p => { p.hasActed = false; p.hasVoted = false; p.voyanteSeen = false; });
                setNightTimer(120);
                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const nightAction = async (targetId, actionType) => {
                if (!db) return;
                const newGameState = { ...gameState };
                const currentPlayer = newGameState.players.find(p => p.name === playerName);
                if (!currentPlayer || !currentPlayer.isAlive) return;

                if (actionType === 'loup') {
                    if (currentPlayer.role !== 'loupGarou') return;
                    const target = newGameState.players.find(p => p.id === targetId);
                    if (target.role === 'loupGarou') { alert('Vous ne pouvez pas tuer un autre loup !'); return; }
                    if (!newGameState.nightActions.loupVotes) newGameState.nightActions.loupVotes = {};
                    newGameState.nightActions.loupVotes[currentPlayer.id] = targetId;
                } else if (actionType === 'voyante') {
                    if (currentPlayer.role !== 'voyante' || currentPlayer.voyanteSeen) return;
                    const target = newGameState.players.find(p => p.id === targetId);
                    alert(`${target.name} est ${roles.find(r => r.id === target.role)?.name}`);
                    currentPlayer.voyanteSeen = true;
                } else if (actionType === 'pretre') {
                    if (currentPlayer.role !== 'pretre') return;
                    if (currentPlayer.lastBlessedId === targetId) {
                        alert('Vous ne pouvez pas b√©nir la m√™me personne deux nuits de suite !');
                        return;
                    }
                    newGameState.nightActions.blessed = targetId;
                    currentPlayer.lastBlessedId = targetId;
                }

                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const sorciereAction = async (actionType, targetId = null) => {
                if (!db) return;
                const newGameState = { ...gameState };
                const currentPlayer = newGameState.players.find(p => p.name === playerName);
                if (currentPlayer.role !== 'sorciere' || !currentPlayer.isAlive) return;

                if (actionType === 'heal') {
                    if (currentPlayer.sorciereHealUsed) { alert('Vous avez d√©j√† utilis√© votre potion de vie !'); return; }
                    newGameState.nightActions.sorciereHeal = true;
                    currentPlayer.sorciereHealUsed = true;
                } else if (actionType === 'kill') {
                    if (currentPlayer.sorciereKillUsed) { alert('Vous avez d√©j√† utilis√© votre potion de mort !'); return; }
                    newGameState.nightActions.sorciereKill = targetId;
                    currentPlayer.sorciereKillUsed = true;
                }

                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const endNight = async () => {
                if (!db || !isHost) return;
                const newGameState = { ...gameState };

                let killedByWolves = null;
                if (newGameState.nightActions.loupVotes) {
                    const votes = Object.values(newGameState.nightActions.loupVotes);
                    const voteCounts = {};
                    votes.forEach(id => voteCounts[id] = (voteCounts[id] || 0) + 1);
                    const maxVotes = Math.max(...Object.values(voteCounts));
                    const candidates = Object.keys(voteCounts).filter(id => voteCounts[id] === maxVotes);
                    killedByWolves = candidates[Math.floor(Math.random() * candidates.length)];
                }

                if (killedByWolves && newGameState.nightActions.sorciereHeal) killedByWolves = null;
                if (killedByWolves && newGameState.nightActions.blessed === killedByWolves) killedByWolves = null;

                if (killedByWolves) {
                    const player = newGameState.players.find(p => p.id === killedByWolves);
                    if (player) player.isAlive = false;
                }

                if (newGameState.nightActions.sorciereKill) {
                    const player = newGameState.players.find(p => p.id === newGameState.nightActions.sorciereKill);
                    if (player) player.isAlive = false;
                }

                const wolves = newGameState.players.filter(p => p.role === 'loupGarou' && p.isAlive);
                const villagers = newGameState.players.filter(p => p.role !== 'loupGarou' && p.isAlive);

                if (wolves.length === 0) { alert('üéâ Les Villageois ont gagn√© !'); await leaveRoom(); return; }
                if (wolves.length >= villagers.length) { alert('üê∫ Les Loups-Garous ont gagn√© !'); await leaveRoom(); return; }

                newGameState.phase = 'day';
                newGameState.dayMessage = 'Le village se r√©veille !';
                newGameState.players.forEach(p => p.voyanteSeen = false);

                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const startVoting = async () => {
                if (!db || !isHost) return;
                const newGameState = { ...gameState };
                newGameState.phase = 'vote';
                newGameState.votes = {};
                newGameState.players.forEach(p => p.hasVoted = false);
                setVoteTimer(30);
                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const vote = async (targetId) => {
                if (!db) return;
                const newGameState = { ...gameState };
                const voter = newGameState.players.find(p => p.name === playerName);
                if (!voter || !voter.isAlive || voter.hasVoted) return;

                if (!newGameState.votes) newGameState.votes = {};
                newGameState.votes[voter.id] = targetId;
                voter.hasVoted = true;

                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const endVoting = async () => {
                if (!db || !isHost) return;
                const newGameState = { ...gameState };

                const voteCounts = {};
                Object.values(newGameState.votes || {}).forEach(id => {
                    voteCounts[id] = (voteCounts[id] || 0) + 1;
                });

                const maxVotes = Math.max(...Object.values(voteCounts));
                const tiedPlayers = Object.keys(voteCounts).filter(id => voteCounts[id] === maxVotes);

                if (tiedPlayers.length > 1) {
                    newGameState.phase = 'tiebreak';
                    newGameState.tiedPlayers = tiedPlayers;
                } else if (tiedPlayers.length === 1) {
                    const eliminated = newGameState.players.find(p => p.id === tiedPlayers[0]);
                    if (eliminated) {
                        eliminated.isAlive = false;
                        if (eliminated.role === 'chasseur') {
                            newGameState.phase = 'chasseur';
                            newGameState.chasseurId = eliminated.id;
                        } else {
                            checkVictoryAndContinue(newGameState);
                        }
                    }
                } else {
                    checkVictoryAndContinue(newGameState);
                }

                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const tiebreakVote = async (playerId) => {
                if (!db || !isHost) return;
                const newGameState = { ...gameState };
                const eliminated = newGameState.players.find(p => p.id === playerId);
                if (eliminated) {
                    eliminated.isAlive = false;
                    if (eliminated.role === 'chasseur') {
                        newGameState.phase = 'chasseur';
                        newGameState.chasseurId = eliminated.id;
                    } else {
                        checkVictoryAndContinue(newGameState);
                    }
                }
                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const chasseurShoot = async (targetId) => {
                if (!db) return;
                const newGameState = { ...gameState };
                const target = newGameState.players.find(p => p.id === targetId);
                if (target) target.isAlive = false;
                checkVictoryAndContinue(newGameState);
                try { await db.ref(`rooms/${roomCode}/gameState`).set(newGameState); } catch (err) { }
            };

            const checkVictoryAndContinue = async (newGameState) => {
                const wolves = newGameState.players.filter(p => p.role === 'loupGarou' && p.isAlive);
                const villagers = newGameState.players.filter(p => p.role !== 'loupGarou' && p.isAlive);

                if (wolves.length === 0) { alert('üéâ Les Villageois ont gagn√© !'); await leaveRoom(); return; }
                if (wolves.length >= villagers.length) { alert('üê∫ Les Loups-Garous ont gagn√© !'); await leaveRoom(); return; }

                newGameState.phase = 'sleep';
                newGameState.dayMessage = 'Le village s\'endort...';
                newGameState.round += 1;

                try {
                    await db.ref(`rooms/${roomCode}/gameState`).set(newGameState);
                    setTimeout(() => startNight(), 3000);
                } catch (err) { }
            };

            if (screen === 'home') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 relative z-10 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
                        <div className="max-w-md w-full">
                            <div className="text-center mb-12 animate-fade-in">
                                <div className="flex justify-center mb-6"><Moon className="w-20 h-20 text-red-500 pulse-glow" /></div>
                                <h1 className="text-6xl font-black text-white mb-3 cinzel">LOUP-GAROU</h1>
                                <p className="text-purple-300 text-lg">Le village s'√©veille...</p>
                            </div>
                            <div className="bg-black/40 backdrop-blur-xl p-8 rounded-3xl border border-purple-500/30">
                                <input type="text" value={playerName} onChange={(e) => setPlayerName(e.target.value)} className="w-full bg-white/10 text-white border border-purple-500/30 rounded-xl px-4 py-3 mb-4 focus:outline-none" placeholder="Entrez votre nom" />
                                <button onClick={createRoom} className="w-full bg-gradient-to-r from-red-600 to-purple-600 text-white py-4 px-6 rounded-2xl font-bold mb-3 hover:from-red-500 hover:to-purple-500">
                                    <Crown className="w-6 h-6 inline mr-3" />Cr√©er un Salon
                                </button>
                                <button onClick={() => setScreen('join')} className="w-full bg-white/10 text-white py-4 px-6 rounded-2xl font-bold hover:bg-white/20">
                                    <Users className="w-6 h-6 inline mr-3" />Rejoindre un Salon
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'join') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 relative z-10 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
                        <div className="max-w-md w-full">
                            <button onClick={() => setScreen('home')} className="text-purple-300 mb-6 hover:text-white">‚Üê Retour</button>
                            <div className="bg-black/40 backdrop-blur-xl p-8 rounded-3xl border border-purple-500/30">
                                <h2 className="text-3xl font-bold text-white mb-6 cinzel">Rejoindre</h2>
                                <input type="text" value={playerName} onChange={(e) => setPlayerName(e.target.value)} className="w-full bg-white/10 text-white border border-purple-500/30 rounded-xl px-4 py-3 mb-4 focus:outline-none" placeholder="Votre nom" />
                                <input type="text" value={roomCode} onChange={(e) => setRoomCode(e.target.value.replace(/\D/g, '').slice(0, 6))} className="w-full bg-white/10 text-white border border-purple-500/30 rounded-xl px-4 py-3 mb-4 text-2xl text-center tracking-widest font-bold focus:outline-none" placeholder="000000" maxLength={6} />
                                {error && <div className="bg-red-500/20 border border-red-500 text-red-300 px-4 py-3 rounded-xl mb-4">{error}</div>}
                                <button onClick={joinRoom} className="w-full bg-gradient-to-r from-red-600 to-purple-600 text-white py-4 rounded-2xl font-bold">Rejoindre</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (screen === 'lobby') {
                return (
                    <div className="min-h-screen p-4 relative z-10 bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
                        <div className="max-w-4xl mx-auto py-8">
                            <div className="flex justify-between items-center mb-8">
                                <h2 className="text-3xl font-bold text-white cinzel">Salon d'Attente</h2>
                                <button onClick={leaveRoom} className="text-red-400 hover:text-red-300"><LogOut className="w-5 h-5" /></button>
                            </div>
                            <div className="bg-black/40 backdrop-blur-xl p-8 rounded-3xl border border-purple-500/30 mb-6">
                                <div className="flex items-center justify-between mb-6">
                                    <div>
                                        <p className="text-purple-300 text-sm">Code du salon</p>
                                        <p className="text-4xl font-bold text-white tracking-wider">{roomCode}</p>
                                    </div>
                                    <button onClick={copyRoomCode} className="bg-purple-600 hover:bg-purple-500 text-white px-6 py-3 rounded-xl font-bold">
                                        {copied ? <><Check className="w-5 h-5 inline mr-2" />Copi√© !</> : <><Copy className="w-5 h-5 inline mr-2" />Copier</>}
                                    </button>
                                </div>
                                <div className="border-t border-white/10 pt-6">
                                    <p className="text-purple-300 mb-4">Joueurs: {players.length} {players.length < 4 ? '(min 4)' : ''}</p>
                                    <div className="grid grid-cols-2 gap-3">
                                        {players.map((player) => (
                                            <div key={player.id} className="bg-white/5 border border-white/10 rounded-xl px-4 py-3 flex items-center">
                                                {player.name === currentRoom?.host && <Crown className="w-5 h-5 text-yellow-400 mr-2" />}
                                                <span className="text-white">{player.name}</span>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            {isHost && (
                                <div className="bg-black/40 backdrop-blur-xl p-8 rounded-3xl border border-purple-500/30">
                                    <h3 className="text-2xl font-bold text-white mb-6">Configuration</h3>
                                    <div className="grid gap-4 mb-6">
                                        {roles.map(role => (
                                            <div key={role.id} className="bg-white/5 border border-white/10 rounded-xl p-4 flex items-center justify-between">
                                                <div className="flex items-center">
                                                    <role.icon className="w-6 h-6 mr-3" style={{ color: role.color }} />
                                                    <div>
                                                        <p className="text-white font-bold">{role.name}</p>
                                                        <p className="text-purple-300 text-sm">{role.description}</p>
                                                    </div>
                                                </div>
                                                <div className="flex items-center space-x-2">
                                                    <button onClick={() => setRoleConfig({ ...roleConfig, [role.id]: Math.max(0, roleConfig[role.id] - 1) })} className="bg-white/10 hover:bg-white/20 text-white w-8 h-8 rounded-lg font-bold">-</button>
                                                    <span className="text-white font-bold w-8 text-center">{roleConfig[role.id]}</span>
                                                    <button onClick={() => setRoleConfig({ ...roleConfig, [role.id]: roleConfig[role.id] + 1 })} className="bg-white/10 hover:bg-white/20 text-white w-8 h-8 rounded-lg font-bold">+</button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    {error && <div className="bg-red-500/20 border border-red-500 text-red-300 px-4 py-3 rounded-xl mb-4">{error}</div>}
                                    <button onClick={startGame} disabled={players.length < 4} className="w-full bg-gradient-to-r from-red-600 to-purple-600 text-white py-4 rounded-2xl font-bold disabled:opacity-50">
                                        {players.length < 4 ? `En attente (${players.length}/4)` : 'Lancer la Partie'}
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (screen === 'game' && gameState) {
                const currentPlayer = gameState.players.find(p => p.name === playerName);
                const alivePlayers = gameState.players.filter(p => p.isAlive);
                const myRole = roles.find(r => r.id === currentPlayer?.role);
                const isNight = gameState.phase === 'night';
                const bgClass = isNight || gameState.phase === 'sleep' ? 'night-bg' : 'day-bg';
                const textColor = isNight || gameState.phase === 'sleep' ? 'text-white' : 'text-gray-900';

                const sorciereNotif = currentPlayer?.role === 'sorciere' && isNight && gameState.nightActions?.loupVotes;

                return (
                    <div className={`min-h-screen p-4 relative z-10 ${bgClass}`}>
                        <div className="max-w-6xl mx-auto py-8">
                            <div className="bg-black/40 backdrop-blur-xl p-6 rounded-3xl border border-white/20 mb-6">
                                <div className="flex justify-between items-center">
                                    <div className="flex items-center space-x-6">
                                        <div>
                                            <p className="text-purple-300 text-sm">Tour</p>
                                            <p className={`text-3xl font-bold ${textColor}`}>{gameState.round}</p>
                                        </div>
                                        <div className="h-12 w-px bg-white/20"></div>
                                        <div>
                                            <p className="text-purple-300 text-sm">Phase</p>
                                            <div className="flex items-center">
                                                {isNight ? <><Moon className="w-6 h-6 text-blue-400 mr-2" /><p className={`text-xl font-bold ${textColor}`}>Nuit - {nightTimer}s</p></> :
                                                    gameState.phase === 'vote' ? <><Sun className="w-6 h-6 text-yellow-600 mr-2" /><p className="text-xl font-bold text-gray-900">Vote - {voteTimer}s</p></> :
                                                        gameState.phase === 'day' ? <><Sun className="w-6 h-6 text-yellow-600 mr-2" /><p className="text-xl font-bold text-gray-900">Jour</p></> :
                                                            <><Moon className="w-6 h-6 text-blue-400 mr-2" /><p className={`text-xl font-bold ${textColor}`}>Transition</p></>}
                                            </div>
                                        </div>
                                    </div>
                                    <button onClick={leaveRoom} className="text-red-400 hover:text-red-300"><LogOut className="w-6 h-6" /></button>
                                </div>
                            </div>

                            {gameState.dayMessage && (
                                <div className="bg-black/40 backdrop-blur-xl p-6 rounded-3xl border border-white/20 mb-6 text-center">
                                    <p className={`text-2xl font-bold ${textColor}`}>{gameState.dayMessage}</p>
                                </div>
                            )}

                            <div className="bg-black/40 backdrop-blur-xl p-6 rounded-3xl border border-white/20 mb-6">
                                <p className="text-purple-300 text-sm mb-2">Votre r√¥le</p>
                                <div className="flex items-center">
                                    {myRole && <myRole.icon className="w-8 h-8 mr-3" style={{ color: myRole.color }} />}
                                    <div>
                                        <p className={`text-2xl font-bold ${textColor}`}>{myRole?.name}</p>
                                        <p className="text-purple-300 text-sm">{myRole?.description}</p>
                                    </div>
                                </div>
                                {!currentPlayer?.isAlive && <div className="mt-4 bg-red-500/20 border border-red-500 text-red-300 px-4 py-2 rounded-xl flex items-center"><Skull className="w-5 h-5 mr-2" />Vous √™tes mort - Vous ne pouvez plus jouer</div>}
                            </div>

                            {isNight && currentPlayer?.isAlive && (
                                <div className="bg-black/40 backdrop-blur-xl p-6 rounded-3xl border border-white/20 mb-6">
                                    <h3 className="text-xl font-bold text-white mb-4">Actions de nuit ({Math.floor(nightTimer / 60)}:{String(nightTimer % 60).padStart(2, '0')})</h3>

                                    {currentPlayer.role === 'loupGarou' && (
                                        <>
                                            <p className="text-purple-300 mb-3">Choisissez votre victime (pas un autre loup)</p>
                                            <div className="grid grid-cols-2 gap-3">
                                                {alivePlayers.filter(p => p.role !== 'loupGarou').map(player => (
                                                    <button key={player.id} onClick={() => nightAction(player.id, 'loup')} className="bg-red-600/20 hover:bg-red-600/30 border border-red-500 text-white px-4 py-3 rounded-xl">{player.name}</button>
                                                ))}
                                            </div>
                                        </>
                                    )}

                                    {currentPlayer.role === 'voyante' && !currentPlayer.voyanteSeen && (
                                        <>
                                            <p className="text-purple-300 mb-3">Regardez UNE carte</p>
                                            <div className="grid grid-cols-2 gap-3">
                                                {alivePlayers.filter(p => p.id !== currentPlayer.id).map(player => (
                                                    <button key={player.id} onClick={() => nightAction(player.id, 'voyante')} className="bg-purple-600/20 hover:bg-purple-600/30 border border-purple-500 text-white px-4 py-3 rounded-xl">{player.name}</button>
                                                ))}
                                            </div>
                                        </>
                                    )}

                                    {currentPlayer.role === 'pretre' && (
                                        <>
                                            <p className="text-purple-300 mb-3">B√©nissez une personne (pas la m√™me qu'hier)</p>
                                            <div className="grid grid-cols-2 gap-3">
                                                {alivePlayers.filter(p => p.id !== currentPlayer.id && p.id !== currentPlayer.lastBlessedId).map(player => (
                                                    <button key={player.id} onClick={() => nightAction(player.id, 'pretre')} className="bg-cyan-600/20 hover:bg-cyan-600/30 border border-cyan-500 text-white px-4 py-3 rounded-xl">{player.name}</button>
                                                ))}
                                            </div>
                                        </>
                                    )}

                                    {currentPlayer.role === 'sorciere' && (
                                        <>
                                            {sorciereNotif && <p className="text-yellow-300 mb-3">‚ö†Ô∏è Quelqu'un va mourir cette nuit !</p>}
                                            <div className="space-y-3">
                                                {!currentPlayer.sorciereHealUsed && (
                                                    <button onClick={() => sorciereAction('heal')} className="w-full bg-green-600/20 hover:bg-green-600/30 border border-green-500 text-white px-4 py-3 rounded-xl">üíö Sauver la victime</button>
                                                )}
                                                {!currentPlayer.sorciereKillUsed && (
                                                    <>
                                                        <p className="text-purple-300">Tuer quelqu'un :</p>
                                                        <div className="grid grid-cols-2 gap-3">
                                                            {alivePlayers.filter(p => p.id !== currentPlayer.id).map(player => (
                                                                <button key={player.id} onClick={() => sorciereAction('kill', player.id)} className="bg-pink-600/20 hover:bg-pink-600/30 border border-pink-500 text-white px-4 py-3 rounded-xl">{player.name}</button>
                                                            ))}
                                                        </div>
                                                    </>
                                                )}
                                            </div>
                                        </>
                                    )}
                                </div>
                            )}

                            {gameState.phase === 'day' && isHost && (
                                <div className="bg-white/80 backdrop-blur-xl p-6 rounded-3xl border border-gray-300 mb-6">
                                    <h3 className="text-xl font-bold text-gray-900 mb-4">Discussion</h3>
                                    <p className="text-gray-700 mb-4">Discutez pour trouver les loups-garous !</p>
                                    <button onClick={startVoting} className="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white py-4 rounded-2xl font-bold">Passer au Vote</button>
                                </div>
                            )}

                            {gameState.phase === 'vote' && currentPlayer?.isAlive && (
                                <div className="bg-white/80 backdrop-blur-xl p-6 rounded-3xl border border-gray-300 mb-6">
                                    <h3 className="text-xl font-bold text-gray-900 mb-4">Votez pour √©liminer (30s)</h3>
                                    {!currentPlayer.hasVoted ? (
                                        <div className="grid grid-cols-2 gap-3">
                                            {alivePlayers.filter(p => p.id !== currentPlayer.id).map(player => (
                                                <button key={player.id} onClick={() => vote(player.id)} className="bg-orange-600/20 hover:bg-orange-600/30 border border-orange-500 text-gray-900 px-4 py-3 rounded-xl font-bold">{player.name}</button>
                                            ))}
                                        </div>
                                    ) : (
                                        <div className="bg-green-500/20 border border-green-500 text-green-700 px-4 py-3 rounded-xl"><Check className="w-5 h-5 inline mr-2" />Vous avez vot√©</div>
                                    )}
                                </div>
                            )}

                            {gameState.phase === 'tiebreak' && isHost && (
                                <div className="bg-white/80 backdrop-blur-xl p-6 rounded-3xl border border-gray-300 mb-6">
                                    <h3 className="text-xl font-bold text-gray-900 mb-4">üëë Chef de village, d√©partagez !</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        {gameState.tiedPlayers.map(playerId => {
                                            const player = gameState.players.find(p => p.id === playerId);
                                            return <button key={playerId} onClick={() => tiebreakVote(playerId)} className="bg-red-600 hover:bg-red-500 text-white px-4 py-3 rounded-xl font-bold">{player?.name}</button>;
                                        })}
                                    </div>
                                </div>
                            )}

                            {gameState.phase === 'chasseur' && currentPlayer?.id === gameState.chasseurId && (
                                <div className="bg-white/80 backdrop-blur-xl p-6 rounded-3xl border border-gray-300 mb-6">
                                    <h3 className="text-xl font-bold text-gray-900 mb-4">üéØ Chasseur, tirez !</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        {alivePlayers.map(player => (
                                            <button key={player.id} onClick={() => chasseurShoot(player.id)} className="bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-3 rounded-xl font-bold">{player.name}</button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <div className="bg-black/40 backdrop-blur-xl p-6 rounded-3xl border border-white/20">
                                <h3 className={`text-xl font-bold ${textColor} mb-4`}>Joueurs</h3>
                                <div className="grid grid-cols-2 gap-3">
                                    {gameState.players.map(player => (
                                        <div key={player.id} className={`border rounded-xl px-4 py-3 ${player.isAlive ? 'bg-white/5 border-white/10' : 'bg-red-500/10 border-red-500/30 opacity-50'}`}>
                                            <div className="flex items-center justify-between">
                                                <span className={textColor}>{player.name}</span>
                                                {!player.isAlive && <Skull className="w-5 h-5 text-red-400" />}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('app'));
        root.render(<LoupGarou />);
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js').then(r => console.log('‚úÖ SW:', r.scope)).catch(e => console.log('‚ùå SW:', e));
        }
    </script>
</body>

</html>
